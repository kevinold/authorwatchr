<%init>
use Data::Dumper;
my $ref = $c->stash->{records};
my $auth_is_saved;

if ( $c->user ) {
    my $auth_rs = $c->user->my_authors;
    while ( my $auth = $auth_rs->next ) {
        my $name = $auth->authors->first_name . " " . $auth->authors->last_name;
        my $st = $c->stash->{search_term};
        $auth_is_saved = 1 if lc $st eq lc $name ;
    }
}

</%init>

<% $c->stash->{error_msg} %>

<h2>Results for "<% $c->stash->{search_term} %>"</h2>

% unless ( $auth_is_saved ) {
<!-- Show "save to list" -->
<a id="save_author" href="#">Save <b><% $c->stash->{search_term} %></b> to your favorites</a>

<script type="text/javascript">
$("#save_author").click(function(){
  $(this).load('<% $c->uri_for("/user/save_author") %>', { value: "<% $c->stash->{search_term} %>" }, function() { $("#my_authors").load('<% $c->uri_for("/user/list_authors") %>') });
});
</script>

% } else {
Login to Save <b><% $c->stash->{search_term} %></b> to your favorites.
% }

% foreach my $rec ( keys %{$ref} ) {
    <p id="details_<% $rec %>" class="author_results">
        <div style="float:left">
    <img src="<% $ref->{$rec}->{smallimage} %>" height="<% $ref->{$rec}->{smallimageheight} %>" width="<% $ref->{$rec}->{smallimagewidth} %>" />
        </div>

        <div style="float:right;width:400px;background-color:#bdbdbd;">
    <% $rec %><br/>
    <b><% $ref->{$rec}->{title} %></b><br/>
    <% $ref->{$rec}->{author} %><br/>

    Publish Date: <% $ref->{$rec}->{pubdate} %><br/>
    Newest Low Price: <% $ref->{$rec}->{formattedprice} %><br/>
    <a href="<% $ref->{$rec}->{detailpageurl} %>">View Details</a>
        </div>
    </p>
<br clear="all"/>
% }

<%doc>
<%flags>
inherit => undef
</%flags>
</%doc>
